import{_ as i,c as a,o as n,ag as l}from"./chunks/framework.ymCRTBvy.js";const c=JSON.parse('{"title":"å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ","description":"","frontmatter":{},"headers":[],"relativePath":"network/8.2_å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ.md","filePath":"network/8.2_å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ.md"}'),p={name:"network/8.2_å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ.md"};function e(h,s,t,k,r,E){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ" tabindex="-1">å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ <a class="header-anchor" href="#å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ" aria-label="Permalink to &quot;å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸ&quot;">â€‹</a></h1><p>åœ¨SwiftUIä¸­ï¼Œå¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†è‡³å…³é‡è¦ã€‚é€šè¿‡åˆç†çš„ç®¡ç†ï¼Œæ‚¨å¯ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³é”®ç‚¹ï¼Œå¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£å’Œå¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><h2 id="_1-å¼‚æ­¥ä»»åŠ¡çš„åˆ›å»ºä¸å¯åŠ¨" tabindex="-1">1. å¼‚æ­¥ä»»åŠ¡çš„åˆ›å»ºä¸å¯åŠ¨ <a class="header-anchor" href="#_1-å¼‚æ­¥ä»»åŠ¡çš„åˆ›å»ºä¸å¯åŠ¨" aria-label="Permalink to &quot;1. å¼‚æ­¥ä»»åŠ¡çš„åˆ›å»ºä¸å¯åŠ¨&quot;">â€‹</a></h2><ul><li>ä½¿ç”¨<code>Task</code>æ¥åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ã€‚æ‚¨å¯ä»¥åœ¨è§†å›¾çš„<code>onAppear</code>æˆ–<code>task</code>ä¿®é¥°ç¬¦ä¸­å¯åŠ¨ä»»åŠ¡ã€‚</li><li>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨è§†å›¾åŠ è½½æ—¶å‘èµ·ç½‘ç»œè¯·æ±‚ï¼š</li></ul><div class="language-swift vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ContentView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">View </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> body: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> View {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello, World!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å¼‚æ­¥ç½‘ç»œè¯·æ±‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="_2-ä»»åŠ¡çš„å–æ¶ˆ" tabindex="-1">2. ä»»åŠ¡çš„å–æ¶ˆ <a class="header-anchor" href="#_2-ä»»åŠ¡çš„å–æ¶ˆ" aria-label="Permalink to &quot;2. ä»»åŠ¡çš„å–æ¶ˆ&quot;">â€‹</a></h2><ul><li>ä»»åŠ¡å¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è¢«å–æ¶ˆï¼Œä¾‹å¦‚ç”¨æˆ·ç¦»å¼€è§†å›¾æˆ–ä¸å†éœ€è¦æ•°æ®æ—¶ã€‚</li><li>ä½¿ç”¨<code>Task</code>çš„<code>cancel()</code>æ–¹æ³•å¯ä»¥å–æ¶ˆä»»åŠ¡ã€‚ç¡®ä¿åœ¨é€‚å½“çš„æ—¶æœºè°ƒç”¨å®ƒï¼Œä»¥é¿å…ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ã€‚</li></ul><div class="language-swift vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ContentView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">View </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    @State</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> task: Task&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Never</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> nil</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> body: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> View {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        Button</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;å¼€å§‹ä»»åŠ¡&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            task </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">onDisappear</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            task</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cancel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è§†å›¾æ¶ˆå¤±æ—¶å–æ¶ˆä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="_3-å¤„ç†ä»»åŠ¡çš„ç»“æœ" tabindex="-1">3. å¤„ç†ä»»åŠ¡çš„ç»“æœ <a class="header-anchor" href="#_3-å¤„ç†ä»»åŠ¡çš„ç»“æœ" aria-label="Permalink to &quot;3. å¤„ç†ä»»åŠ¡çš„ç»“æœ&quot;">â€‹</a></h2><ul><li>ä½¿ç”¨<code>await</code>å…³é”®å­—æ¥ç­‰å¾…å¼‚æ­¥ä»»åŠ¡çš„ç»“æœã€‚ç¡®ä¿åœ¨å¤„ç†ç»“æœæ—¶è€ƒè™‘åˆ°å¯èƒ½çš„é”™è¯¯ã€‚</li><li>é€šè¿‡<code>do-catch</code>è¯­å¥æ¥æ•è·å’Œå¤„ç†é”™è¯¯ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§ã€‚</li></ul><div class="language-swift vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> try</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fetchFromNetwork</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å¤„ç†æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;å‘ç”Ÿé”™è¯¯: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\(error)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_4-ä»»åŠ¡çš„çŠ¶æ€ç®¡ç†" tabindex="-1">4. ä»»åŠ¡çš„çŠ¶æ€ç®¡ç† <a class="header-anchor" href="#_4-ä»»åŠ¡çš„çŠ¶æ€ç®¡ç†" aria-label="Permalink to &quot;4. ä»»åŠ¡çš„çŠ¶æ€ç®¡ç†&quot;">â€‹</a></h2><ul><li>ä½¿ç”¨<code>@State</code>æˆ–<code>@StateObject</code>æ¥ç®¡ç†ä»»åŠ¡çš„çŠ¶æ€ã€‚è¿™æ ·å¯ä»¥åœ¨UIä¸­åæ˜ ä»»åŠ¡çš„è¿›åº¦æˆ–ç»“æœã€‚</li><li>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ä»»åŠ¡å¼€å§‹æ—¶æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨ï¼Œåœ¨ä»»åŠ¡å®Œæˆåæ›´æ–°UIã€‚</li></ul><div class="language-swift vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@State</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> private</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isLoading </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> body: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">some</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> View {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    VStack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isLoading {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            ProgressView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            Text</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;æ•°æ®åŠ è½½å®Œæˆ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        isLoading </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        await</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> fetchData</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        isLoading </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œæ‚¨å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œç¡®ä¿åº”ç”¨ç¨‹åºåœ¨å¤„ç†å¼‚æ­¥æ“ä½œæ—¶çš„æµç•…æ€§å’Œç¨³å®šæ€§ã€‚æŒæ¡è¿™äº›æŠ€å·§ï¼Œå°†ä½¿æ‚¨çš„SwiftUIåº”ç”¨ç¨‹åºæ›´åŠ é«˜æ•ˆå’Œç”¨æˆ·å‹å¥½ï¼ğŸš€</p>`,15)]))}const g=i(p,[["render",e]]);export{c as __pageData,g as default};
