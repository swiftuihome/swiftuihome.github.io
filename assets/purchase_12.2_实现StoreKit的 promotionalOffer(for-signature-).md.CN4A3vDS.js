import{_ as s,c as i,o as n,ag as e}from"./chunks/framework.Bw-5EFTY.js";const c=JSON.parse('{"title":"实现StoreKit的 promotionalOffer(for-signature-)","description":"","frontmatter":{},"headers":[],"relativePath":"purchase/12.2_实现StoreKit的 promotionalOffer(for-signature-).md","filePath":"purchase/12.2_实现StoreKit的 promotionalOffer(for-signature-).md"}'),r={name:"purchase/12.2_实现StoreKit的 promotionalOffer(for-signature-).md"};function t(l,a,o,p,h,k){return n(),i("div",null,a[0]||(a[0]=[e(`<h1 id="实现storekit的-promotionaloffer-for-signature" tabindex="-1">实现StoreKit的 promotionalOffer(for-signature-) <a class="header-anchor" href="#实现storekit的-promotionaloffer-for-signature" aria-label="Permalink to &quot;实现StoreKit的 promotionalOffer(for-signature-)&quot;">​</a></h1><h2 id="促销优惠的魅力" tabindex="-1">促销优惠的魅力 <a class="header-anchor" href="#促销优惠的魅力" aria-label="Permalink to &quot;促销优惠的魅力&quot;">​</a></h2><p>促销优惠是吸引新用户和留住现有用户的绝佳方式。它们能显著提升订阅转化率。通过提供折扣或免费试用，您可以有效降低用户初次订阅的门槛。</p><p>StoreKit 2 极大地简化了促销优惠的实现。您不再需要复杂的服务器端签名。这让开发过程变得更加流畅和高效。</p><h2 id="实现-promotionaloffer-for-signature" tabindex="-1">实现 promotionalOffer(for:signature:) <a class="header-anchor" href="#实现-promotionaloffer-for-signature" aria-label="Permalink to &quot;实现 promotionalOffer(for:signature:)&quot;">​</a></h2><p><code>promotionalOffer(for:signature:)</code> 方法是实现促销优惠的核心。它允许您在应用内直接应用这些优惠。您需要提供优惠的 ID 和签名。</p><p>签名通常由您的服务器生成。它确保了优惠的真实性和安全性。这个过程保障了交易的完整性。</p><h2 id="步骤概览" tabindex="-1">步骤概览 <a class="header-anchor" href="#步骤概览" aria-label="Permalink to &quot;步骤概览&quot;">​</a></h2><ol><li><strong>获取优惠 ID</strong>：在 App Store Connect 中配置您的促销优惠。每个优惠都有一个唯一的 ID。</li><li><strong>服务器签名</strong>：您的服务器会根据优惠 ID 和用户 ID 生成一个签名。这个签名是加密的。</li><li><strong>应用内调用</strong>：在您的 SwiftUI 视图中调用 <code>promotionalOffer(for:signature:)</code>。</li></ol><div class="language-swift vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">swift</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Task</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    do</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        _</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> try</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> product.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">promotionalOffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: offerID, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">signature</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: offerSignature)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 优惠应用成功</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 处理错误</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;应用促销优惠失败: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\\(error)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="签名生成与验证" tabindex="-1">签名生成与验证 <a class="header-anchor" href="#签名生成与验证" aria-label="Permalink to &quot;签名生成与验证&quot;">​</a></h2><p>尽管 StoreKit 2 简化了客户端实现，但服务器端签名仍然至关重要。签名验证了优惠的合法性。这有效防止了欺诈行为。</p><p>服务器需要使用您的 App Store Connect API 密钥来生成签名。这是一个安全且可靠的过程。它确保了只有授权的优惠才能被应用。</p><h2 id="签名参数" tabindex="-1">签名参数 <a class="header-anchor" href="#签名参数" aria-label="Permalink to &quot;签名参数&quot;">​</a></h2><ul><li><code>offerID</code>：促销优惠的唯一标识符。</li><li><code>productID</code>：与优惠关联的产品 ID。</li><li><code>applicationUsername</code>：用户的唯一标识符（可选）。</li><li><code>nonce</code>：一个随机数，用于防止重放攻击。</li><li><code>timestamp</code>：签名生成的时间戳。</li></ul><p>这些参数共同构成了签名的基础。它们确保了每个优惠请求都是独一无二的。</p><h2 id="成功应用优惠" tabindex="-1">成功应用优惠 <a class="header-anchor" href="#成功应用优惠" aria-label="Permalink to &quot;成功应用优惠&quot;">​</a></h2><p>当 <code>promotionalOffer(for:signature:)</code> 成功执行后，用户将享受到相应的优惠。这可能是一个折扣价格或免费试用期。您会看到用户订阅行为的积极变化。</p><p>例如，数据显示，提供促销优惠可以使订阅转化率提高 15% 到 20%。这是一个非常显著的提升！🚀</p><h2 id="错误处理" tabindex="-1">错误处理 <a class="header-anchor" href="#错误处理" aria-label="Permalink to &quot;错误处理&quot;">​</a></h2><p>在实际应用中，您需要妥善处理可能出现的错误。例如，网络问题或签名无效。提供清晰的用户反馈至关重要。</p><ul><li><strong>用户取消</strong>：用户可能在购买流程中取消。</li><li><strong>签名无效</strong>：服务器生成的签名可能不正确。</li><li><strong>网络问题</strong>：设备可能无法连接到 App Store。</li></ul><p>通过细致的错误处理，您可以确保用户获得流畅的体验。这会大大提升用户满意度。👍</p>`,23)]))}const f=s(r,[["render",t]]);export{c as __pageData,f as default};
